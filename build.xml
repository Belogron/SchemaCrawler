<?xml version="1.0" encoding="UTF-8"?>
<project name="schemacrawler" default="all.build" basedir=".">

  <property name="pom.version" value="4.0" />

  <target name="all.clean">

		<ant
		  antfile="build.xml"
      dir="schemacrawler-maven-plugin"
      target="clean"/>
		<ant
		  antfile="build.xml"
      dir="integrations"
      target="clean"/>
		<ant
		  antfile="build.xml"
      dir="schemacrawler"
      target="clean"/>
		<ant
		  antfile="build.xml"
      dir="dbconnector"
      target="clean"/>

	</target>

  <target name="all.build">

		<ant antfile="integrations/build.xml" inheritAll="false" />
		<ant antfile="schemacrawler-maven-plugin/build.xml" inheritAll="false" />

    <condition property="compiled">
      <and>
        <available file="dbconnector/target/classes" type="dir"/>
        <available file="schemacrawler/target/classes" type="dir"/>
        <available file="integrations/target/classes" type="dir"/>
        <available file="schemacrawler-maven-plugin/target/classes" type="dir"/>
      </and>
    </condition>

    <antcall target="package"/>

	</target>

  <target name="package"
    description="Package all sub-project jars into the distributable jar"
    depends="check_compiled,make_distributable"
  />

  <target name="make_distributable" if="compiled">

    <property
      name="distributable"
      value="_distrib/${ant.project.name}-${pom.version}.jar"/>

    <delete file="{distributable}"/>
    <jar
      destfile="${distributable}"
      duplicate="preserve"
      index="true">
      <manifest>
        <attribute name="Product" value="SchemaCrawler"/>
        <attribute name="Version" value="${pom.version}"/>
        <attribute name="Author" value="Sualeh Fatehi"/>
        <attribute name="Copyright" value="(c) 2003-2006, Sualeh Fatehi"/>
        <attribute name="Main-Class" value="schemacrawler.Main"/>
      </manifest>
      <zipfileset dir="dbconnector/target/classes"/>
      <zipfileset dir="schemacrawler/target/classes"/>
      <zipfileset dir="integrations/target/classes"/>
      <zipfileset dir="schemacrawler-maven-plugin/target/classes"/>
    </jar>

	</target>

  <target name="check_compiled">

    <condition property="compiled">
      <and>
        <available file="dbconnector/target/classes" type="dir"/>
        <available file="schemacrawler/target/classes" type="dir"/>
        <available file="integrations/target/classes" type="dir"/>
        <available file="schemacrawler-maven-plugin/target/classes" type="dir"/>
      </and>
    </condition>

	</target>

  <target name="zip"
    description="Create distributable files for a version">

    <mkdir dir="_backups"/>

    <zip destfile="_backups/SchemaCrawler-${pom.version}-distrib.zip">
      <zipfileset
        dir="_distrib"
        prefix="SchemaCrawler-${pom.version}-distrib">
        <exclude name="**/CVS/**/*"/>
        <exclude name="**/.cvsignore"/>
        <exclude name="**/.svn/**/*"/>
      </zipfileset>
    </zip>

    <zip destfile="_backups/SchemaCrawler-${pom.version}-src.zip">
      <zipfileset
        dir="."
        prefix="SchemaCrawler-${pom.version}-src">
        <exclude name="setm2.cmd"/>
        <exclude name="_backups/*"/>
        <exclude name="**/target/**/*"/>
        <exclude name="**/CVS/**/*"/>
        <exclude name="**/.cvsignore"/>
        <exclude name="**/.svn/**/*"/>
      </zipfileset>
    </zip>

	</target>

</project>
