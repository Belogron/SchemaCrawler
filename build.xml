<?xml version="1.0" encoding="UTF-8"?>
<project name="schemacrawler" default="package" basedir=".">

  <property name="SchemaCrawlerHome" location="." />
  <property name="pom.version" value="4.2" />

  <target name="all.clean">

		<ant
		  antfile="build.xml"
      dir="schemacrawler-maven-plugin"
      target="clean"/>
		<ant
		  antfile="build.xml"
      dir="integrations"
      target="clean"/>
		<ant
		  antfile="build.xml"
      dir="schemacrawler"
      target="clean"/>
		<ant
		  antfile="build.xml"
      dir="dbconnector"
      target="clean"/>

	</target>

  <target name="all.build">

    <ant
      antfile="dbconnector/build.xml"
      inheritAll="false" />
    <ant
      antfile="schemacrawler/build.xml"
      inheritAll="false" />
		<ant
      antfile="integrations/build.xml"
      inheritAll="false" />
		<ant
      antfile="schemacrawler-maven-plugin/build.xml"
      inheritAll="false" />

    <condition property="compiled">
      <and>
        <available file="dbconnector/target/classes" type="dir"/>
        <available file="schemacrawler/target/classes" type="dir"/>
        <available file="integrations/target/classes" type="dir"/>
        <available file="schemacrawler-maven-plugin/target/classes" type="dir"/>
      </and>
    </condition>

	</target>

  <target name="package"
    description="Package all sub-project jars into the distributable jar"
    depends="all.build,make_distributable"
  />

  <target name="make_distributable" depends="all.build" if="compiled">

    <property name="main.project.dir"
      value="."/>

    <property name="distribution.dir"
      value="${main.project.dir}/distribution/target/_distribution"/>
    <property name="distributable.jar"
      value="${distribution.dir}/schemacrawler-${pom.version}.jar"/>

    <delete dir="${distribution.dir}"/>
    <mkdir dir="${distribution.dir}"/>

    <jar
      destfile="${distributable.jar}"
      duplicate="preserve"
      index="true">
      <manifest>
        <attribute name="Product" value="SchemaCrawler"/>
        <attribute name="Version" value="${pom.version}"/>
        <attribute name="Author" value="Sualeh Fatehi"/>
        <attribute name="Copyright" value="(c) 2003-2007, Sualeh Fatehi"/>
        <attribute name="Main-Class" value="schemacrawler.Main"/>
      </manifest>
      <zipfileset
        dir="${main.project.dir}/dbconnector/target/classes"/>
      <zipfileset
        dir="${main.project.dir}/schemacrawler/target/classes"/>
      <zipfileset
        dir="${main.project.dir}/integrations/target/classes"/>
      <zipfileset
        dir="${main.project.dir}/schemacrawler-maven-plugin/target/classes"/>
    </jar>

    <copy
      file="${main.project.dir}/schemacrawler/src/site/resources/config/schemacrawler.config.properties"
      todir="${distribution.dir}"/>

    <mkdir dir="${main.project.dir}/distribution/target/site/examples"/>
    <copy todir="${distribution.dir}/examples">
      <fileset dir="${main.project.dir}/distribution/target/site/examples"/>
    </copy>

    <copy todir="${distribution.dir}/dbserver">
      <fileset dir="${main.project.dir}/_dbserver">
        <exclude name="*.log"/>
        <exclude name="*.lck"/>
        <exclude name="*.properties"/>
      </fileset>
    </copy>

	</target>

  <target name="zip"
    description="Create distributable files for a version">

    <mkdir dir="_backups"/>

    <zip destfile="_backups/SchemaCrawler-${pom.version}-distrib.zip">
      <zipfileset
        dir="_distrib"
        prefix="SchemaCrawler-${pom.version}-distrib">
        <exclude name="**/CVS/**/*"/>
        <exclude name="**/.cvsignore"/>
        <exclude name="**/.svn/**/*"/>
      </zipfileset>
    </zip>

    <zip destfile="_backups/SchemaCrawler-${pom.version}-src.zip">
      <zipfileset
        dir="."
        prefix="SchemaCrawler-${pom.version}-src">
        <exclude name="setm2.cmd"/>
        <exclude name="_backups/*"/>
        <exclude name="**/target/**/*"/>
        <exclude name="**/CVS/**/*"/>
        <exclude name="**/.cvsignore"/>
        <exclude name="**/.svn/**/*"/>
      </zipfileset>
    </zip>

	</target>

</project>
