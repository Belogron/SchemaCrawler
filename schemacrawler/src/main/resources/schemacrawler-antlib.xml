<?xml version="1.0"?>
<antlib>

  <macrodef name="schemacrawler">

    <attribute
      name="config"
      description="Path to the configuration file"
      default="schemacrawler.config.properties" />
    <attribute
      name="config-override"
      description="Path to the configuration override file"
      default="schemacrawler.config.override.properties" />

    <attribute
      name="db-driver-classpath"
      description="Database driver classpath"
      default="${db-driver-classpath}" />

    <!-- Either the datasource, or the connection properties should be
      provided. If both sets are provided, the datasource is ignored. -->

    <attribute
      name="datasource"
      description="Datasource defined in the configuration" />

    <attribute
      name="driver"
      description="JDBC driver class name" />
    <attribute
      name="url"
      description="Database connection string" />
    <attribute
      name="user"
      description="Database connection user name" />
    <attribute
      name="password"
      description="Database connection password"
      default="" />

    <attribute
      name="command"
      description="Comma-separated list of commands" />

    <attribute
      name="no-header"
      description="Whether to print the header - true or false"
      default="false" />
    <attribute
      name="no-footer"
      description="Whether to print the footer - true or false"
      default="false" />
    <attribute
      name="no-info"
      description="Whether to print information - true or false"
      default="false" />

    <attribute
      name="outputformat"
      description="Output format"
      default="text" />
    <attribute
      name="outputfile"
      description="Path to output file" />

    <attribute
      name="append"
      description="Whether to append to the output - true or false"
      default="false" />

    <sequential>

      <!-- Required properties: -->
      <property
        name="schemacrawler.dir"
        value="${basedir}" />

      <java
        taskname="schemacrawler-@{command}"
        classname="schemacrawler.Main"
        logerror="true"
        failonerror="true">
        <classpath>
          <fileset dir="${schemacrawler.dir}">
            <include name="*.jar" />
          </fileset>
          <path refid="@{db-driver-classpath}" />
        </classpath>
        <arg value="-g=@{config}" />
        <arg value="-p=@{config-override}" />
        <arg value="-c=@{datasource}" />
        <arg value="-driver=@{driver}" />
        <arg value="-url=@{url}" />
        <arg value="-user=@{user}" />
        <arg value="-password=@{password}" />
        <arg value="-command=@{command}" />
        <arg value="-noheader=@{no-header}" />
        <arg value="-nofooter=@{no-footer}" />
        <arg value="-noinfo=@{no-info}" />
        <arg value="-outputformat=@{outputformat}" />
        <arg value="-outputfile=@{outputfile}" />
        <arg value="-append=@{append}" />
      </java>

    </sequential>

  </macrodef>

</antlib>
